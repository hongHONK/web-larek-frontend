# Проектная работа "Веб-ларек"
Реализация интернет-магазина "Веб-ларек" с возможностью добавления товара из списка в карзину и дальнейшим приобритением его.

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура проекта: MVP с событийно-ориентированным подходом

### Общее описание
Проект построен на основе архитектурного паттерна **Model-View-Presenter (MVP)** с использованием событийно-ориентированного подхода для управления взаимодействием компонентов. Основная цель этой архитектуры — разделить бизнес-логику, управление состоянием и пользовательский интерфейс, чтобы упростить поддержку и развитие приложения.

### Компоненты

#### Model (Модель)
- Отвечает за управление данными приложения, их получение и сохранение.
- Модель не взаимодействует напрямую с **View**. Она предоставляет данные и методы для изменения данных через **Presenter**.
- В модели могут использоваться сторонние API, локальное хранилище, базы данных и другие ресурсы для работы с данными.

#### View (Представление)
- Представляет собой пользовательский интерфейс (UI), который отображает данные, полученные от **Presenter**.
- **View** подписана на события от **Presenter** и реагирует на изменения состояния приложения.
- Единственная ответственность **View** — это взаимодействие с пользователем (UI) и делегирование действий пользователю через события.

#### Presenter (Презентер) как брокер событий
- Презентер отвечает за бизнес-логику и управление состоянием.
- В этом проекте **Presenter** реализован как брокер событий: он получает события от **View**, обрабатывает их (например, обновляет модель) и генерирует новые события, на которые **View** подписывается.
- Презентер не зависит от деталей реализации пользовательского интерфейса и взаимодействует с ним исключительно через события.
- Презентер также может взаимодействовать с **Model**, если необходимо сохранить или получить данные.

### Поток событий в приложении:
1. **Пользователь** взаимодействует с **View** (например, нажимает кнопку или вводит текст).
2. **View** генерирует событие и отправляет его в **Presenter**.
3. **Presenter** обрабатывает событие: обновляет данные в **Model**, выполняет бизнес-логику или принимает другие решения.
4. После обработки события **Presenter** генерирует новое событие для **View**, уведомляя её об изменении состояния.
5. **View** подписывается на событие от **Presenter** и обновляет UI в соответствии с новыми данными.

### Преимущества событийно-ориентированного подхода
- **Слабая связанность** между компонентами: **View** и **Presenter** не зависят друг от друга напрямую, что упрощает тестирование и поддержку кода.
- **Гибкость расширения**: легко добавлять новые события и обработчики для новых функций, не изменяя существующую архитектуру.
- **Чистая разделённость ответственности**: каждый компонент отвечает за свою область (UI, бизнес-логика, данные).

## Базовые компоненты

### 1. Класс `Api`

Класс `Api` представляет собой обёртку для работы с HTTP-запросами, используя `fetch`. Он упрощает выполнение GET и POST запросов, управляя заголовками и обработкой ответа. Этот класс можно расширять для добавления новых методов HTTP-запросов.

#### Конструктор
```typescript
constructor(baseUrl: string, options: RequestInit = {})
```

#### Методы

- `get(uri: string): Promise<object>` - Отправляет GET-запрос на указанный URI.

- `post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - Отправляет POST-запрос на указанный URI с переданными данными. В зависимости от значения параметра `method`, можно отправлять и другие типы запросов, такие как PUT или PATCH.

#### Внутренние методы

- `protected handleResponse(response: Response): Promise<object>` - Метод обрабатывает ответ от сервера. Если запрос успешен, возвращает JSON. Если нет, пытается обработать ошибку, полученную от сервера, или возвращает текст ошибки.

### 2. Класс `EventEmmiter`

`EventEmitter` — это класс для управления событиями, позволяющий подписываться на события, снимать подписки и инициировать события. Он поддерживает как прямое совпадение имени события, так и шаблоны событий с использованием регулярных выражений.

#### Конструктор
```typescript
constructor() {
    this._events = new Map<EventName, Set<Subscriber>>();
}
```

#### Методы

- `on<T extends object>(eventName: EventName, callback: (event: T) => void)` - устанавливает обработчик на событие с указанным именем.

- `off(eventName: EventName, callback: Subscriber)` - удаляет обработчик с события.

- `emit<T extends object>(eventName: string, data?: T)` - инициирует событие с данными. все подписчики будут вызваны.

- `onAll(callback: (event: EmitterEvent) => void)` - устанавливает обработчик, который будет вызван для всех событий.

- `offAll()` - удаляет все обработчики со всех событий.

- `trigger<T extends object>(eventName: string, context?: Partial<T>)` - создаёт триггер (callback), который инициирует событие при вызове.

## Компоненты модели данных (Model)

### 1. Класс `WebLarekApi`

Является наследником базового класса `Api` и делает взаимодествие с API проекта более нативным и удобным. 
Реализует два интерфейса, один из которых предназначен для модели каталога (`CatalogModel`), а второй- для модели оформления закза (`OrderModel`). Класс поддерживает получение списка продуктов, детальной информации о продукте и отправку заказов.

#### Конструктор
```typescript
constructor(baseUrl: string, imageBaseUrl: string, options?: RequestInit) {
    super(baseUrl, options);
    this.imageBaseUrl = imageBaseUrl;
}
```

- `baseUrl` - базовый URL API

- `imageBaseUrl` - базовый URL ресурса, где хронятся изображения

- `options` - настройки API

#### Методы 

- `getProdList(): Promise<Product[]>` - получает список продуктов. Каждый продукт будет дополнен корректным URL для изображения. Никаких параметров не принимает. Возвращает Promise с массивом объектов типа `Product`.

- `getProdById(id: string): Promise<Product>` - получает информацию о продукте по его `id`. Поле `image` также будет дополнено полным URL. В качестве параметров принимает id продукта. Возвращает Promise с объектом типа `Product`.

- `postOrder(order: Order): Promise<OrderResult>` - отправляет заказ на сервер. В качестве параметра принимает объект типа `Order`. В случае успешного запроса возвращает Promise с объектом типа `OrderResult`.

#### Наследуемые методы

Этот класс наследует все методы класса `Api`, такие как `get()` и `post()`, которые используются для выполнения запросов.

### 2. Класс `CatalogModel`

`CatalogModel` представляет собой модель каталога, которая взаимодействует с API для получения данных о продуктах и управляет их состоянием внутри приложения. Взаимодействие с событиями позволяет обновлять состояние модели и уведомлять об изменениях. Класс включает методы для загрузки списка продуктов, получения продукта по идентификатору, а также для обработки изменений в каталоге.

#### Конструктор
```typescript
constructor(
    protected events: IEvents
) {
    this._productList = new Map<string, Product>();
}
``` 

- `events` - объект, являющийся брокером событий. В нем должны быть реализованы методы `on`, `emit` и `trigger`. 

#### Методы

- `set productList(items: Product[])` - сохраняет список продуктов в модели. В качестве параметра принимает массив объектов типа `Product`.

- `get productList(): Product[]` - возвращает текущий список продуктов, сохранённый в модели. Возвращает массив объектов типа `Product`. 

- `getProductById(id: string): Product` - возвращает продукт по его идентификатору.

#### Внутренние методы

- `onChange(change: CatalogChange): void` - Метод для обработки изменений в модели каталога. Может вызываться при обновлении или изменении состояния каталога.

### 3. Класс `BascetModel`

`BasketModel` представляет собой модель для управления корзиной продуктов. Модель хранит список продуктов в корзине, предоставляет методы для добавления и удаления продуктов, а также вычисляет общее количество и стоимость продуктов в корзине. Класс также поддерживает обработку событий для управления изменениями в корзине.

#### Конструктор
```typescript
constructor(event: IEvents) {}
```

- `event` - объект, являющийся брокером событий. В нем должны быть реализованы методы `on`, `emit` и `trigger`.

#### Методы

- `set items(items: Product[])` - сохраняет список продуктов в карзине. В качестве параметра принимает массив объектов типа `Product`.

- `get items(): Product[]` - возвращает текущий список продуктов, сохранённый в карзине. Возвращает массив объектов типа `Product`.

- `get productIdList(): string[]` - возвращает список идентификаторов продуктов, которые находятся в корзине в виде массива строк.

- `get totalProducts(): number` - возвращает общее количество продуктов в корзине.

- `get totalPrice(): number | null` - возвращает общую стоимость всех продуктов в корзине.

- `addProduct(item: Product): void` - добавляет продукт в корзину. В качестве параметра принимает объект типа `Product`. 

- `removeProduct(item: Product): void` - удаляет продукт из корзины. В качестве параметра принимает объект типа `Product`.

#### Внутренние методы

- `onChange(change: CatalogChange): void` - метод для обработки изменений в корзине. Вызывается при изменениях в корзине, таких как добавление или удаление продуктов. В качестве параметра принимает строку описывающую изменение.

### 4. Класс `OrderModel`

`OrderModel` представляет собой модель для управления заказом. Модель взаимодействует с корзиной покупок и API для отправки заказа. Она также управляет информацией о способе оплаты, адресе, электронной почте и телефоне покупателя, а также отправляет заказ через API.

#### Конструктор
```typescript
constructor(
    bascet: IBascetModel 
) {
    this.bascet = bascet;
}
```

- `bascet` - объект модели данных карзины.

#### Методы

- `set paymentMethod(method: PaymentMethod)` - устанавливает способ оплаты для текущего заказа. В качестве параметра принимает строку.

- `get PaymentMethod(): PaymentMethod` - возвращает текущий способ оплаты в виде строки.

- `set address(data: string)` - устанавливает адрес доставки для текущего заказа. В качестве параметра принимает строку.

- `get address(): string` - возвращает текущий адрес доставки в виде строки.

- `set email(data: string)` - устанавливает электронную почту для текущего заказа. В качестве параметра принимает строку.

- `get email(): string` - возвращает текущий адрес электронной почты для заказа в виде строки.

- `set phone(data: string)` - устанавливает номер телефона для текущего заказа. В качестве параметра принимает строку.

- `get phone(): string` - возвращает текущий номер телефона для заказа в виде строки.

- `get order(): Order` - Возвращает объект, включающий все данные о заказе, включая товары из корзины, способ оплаты, адрес, электронную почту и телефон.

## Компоненты отображения (View)

### 1. Класс `Page`

Класс `Page` управляет элементами интерфейса главной страницы интернет-магазина. Этот класс управляет отображением каталога товаров, контейнера для модальных окон, а также кнопки корзины, размещенной в хеддере страницы. Он предоставляет методы для настройки контента каталога, модального окна, а также управления состоянием счетчика корзины.

### 2. Класс `CatalogCard`

`CatalogCard` — это класс, который отвечает за создание карточки товара в каталоге интернет-магазина. Он предоставляет функционал для отображения информации о продукте, включая название, категорию, изображение, цену и идентификатор товара. Карточка также поддерживает установку обработчика для открытия карточки товара по нажатию на кнопку.

### 3. Класс `BascetCard`

Класс `BascetCard` отвечает за отображение карточки товара в корзине покупок интернет-магазина. Карточка включает в себя название товара, его цену, индекс (позицию в корзине) и кнопку для удаления товара из карзины. Также предоставляет методы для настройки данных карточки и установку обработчика для удаления товара из карзины.

### 4. Класс `CardModal`

`CardModal` — это класс, который создает контент для модального окна, относящийся к карточке товара в интернет-магазине. Он занимается отображением информации о товаре, такой как название, категория, изображение, текстовое описание, цена, а также предоставляет возможность добавления товара в корзину.

### 5. Класс `BascetModal`

Класс `BascetModal` отвечает за управление контентом для модального окна корзины покупок в интернет-магазине. Он отвечает за отображение списка товаров, общую сумму заказа и предоставляет возможность повесить обработчик события на кнопку для подтверждения заказа.

### 6. Класс `ContactsModal`

`ContactsModal` — это класс для управления контентом модального окна ввода контактной информации (email и телефона) при оформлении заказа. Отвечают за форму для заполнения контактной информации пользователя, а также кнопку подтверждения. Благодаря методам класса на кнопку можно повесить обработчик событий.

### 7. Класс `OrderModal`

`OrderModal` — это класс, управляющий контентом модального окна оформления заказа. Отвечает за форму в которой пользователь может выбрать способ оплаты (карта или наличные), ввести адрес доставки и отправить заказ. Оброботчик событий для кнопки отправления заказа устанавливается методом `setSubmitButtonHandler`.

### 8. Класс `SuccessModal`

`SuccessModal` — это класс для управления контентом модального окна успешного оформления заказа. Модальное окно отображает сообщение об успешном завершении и итоговую сумму, а также предоставляет кнопку для закрытия модалки. Обработчик также ставится отдельным методом ~~`бла-бла-бла`~~ `setConfirmButtonHandler`.

## Ключевые типы данных 

```typescript
interface Product {
    id:string;
    description:string;
    image:string;
    title:string;
    category:ProdCategory;
    price:number | null;
} // интерфейс для описания объекта отвара. Такой объект приходит ответом с сервера и используется в дальнейшем всеми модулями приложения 

interface Order {
    payment:PaymentMethod;
    email:string;
    phone:string;
    address:string;
    total:number;
    items:string[];
} // интерфейс для описания объекта собранного заказа. В такой форме данные также отправляются на сервер при оформлении заказа

enum ProdCategory {
    Soft = "софт-скил",
    Hard = "хард-скил",
    Button = "кнопка",
    Extra = "дополнительное",
    Other = "другое"
} // enum для удобства работы с категориями товаров

enum PaymentMethod {
    Online = "online",
    Offline = "offline"
} // enum для работы с методами оплаты, которые может выбрать пользователь и которые в дальнейшем отправляются на сервер

interface OrderResult {
    id:string;
    total:number;
} // интерфейс для описания объекта, который приходид ответом с сервера при успешном заказе
```